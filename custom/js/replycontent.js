!function(){let e=null,t=null;const n=()=>{e&&e.removeEventListener("click",o),e=document.getElementById("waline-wrap"),e&&(e.addEventListener("click",o,{passive:!0}),t&&t.disconnect(),t=new MutationObserver(()=>{n()}),t.observe(e,{childList:!0,subtree:!0}))},o=t=>{const n=t.target.closest("button.wl-reply");if(!n||"true"===e.dataset.pjaxLoading)return;const o=n.closest(".wl-card-item").querySelector(".wl-card > .wl-content");if(!o)return;const c=o.cloneNode(!0);c.querySelectorAll('span, .wl-meta, svg, img, .wl-quote, blockquote, a[href^="#"], pre').forEach(e=>e.remove()),c.querySelectorAll('a:not([href^="#"])').forEach(e=>{const t=e.textContent.trim(),n=e.getAttribute("href")||"";e.replaceWith(`[${t}](${n})`)});const r=c.textContent.replace(/@\S+/g,"").replace(/\n{3,}/g,"\n\n").trim().substring(0,500),s=e.querySelector(".wl-editor");s&&l(s,r)},l=(e,t)=>{const n=`> ${t}\n\n`,o=new Event("input",{bubbles:!0});if("TEXTAREA"===e.tagName||"INPUT"===e.tagName){const t=e.selectionStart;e.value=e.value.slice(0,t)+n+e.value.slice(e.selectionEnd),e.selectionEnd=t+n.length}else if(e.isContentEditable){const t=document.createRange(),o=window.getSelection();t.selectNodeContents(e),t.collapse(!1),t.insertNode(document.createTextNode(n)),o.removeAllRanges(),o.addRange(t)}e.dispatchEvent(o),e.focus()};document.addEventListener("pjax:complete",n),n()}();